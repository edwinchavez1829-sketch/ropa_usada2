<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Eunice Exclusiva - Donde la moda cobra vida</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAJJ9YHnM-crSlzflKkJT2p96r2jmPekWU",
      authDomain: "ropausada-2b9c6.firebaseapp.com",
      projectId: "ropausada-2b9c6",
      storageBucket: "ropausada-2b9c6.appspot.com",
      messagingSenderId: "103550940842",
      appId: "1:103550940842:web:029bfaf4db6d322acd42d3",
      measurementId: "G-M1Y5SLDV2P"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.firebaseApp = { db, ref, push, set, onValue, remove };
  </script>
  <style>
    body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #f7e1a8, #e8a4a4, #d1c4e9); color: #333; min-height: 100vh; margin:0; padding:0; }
    .product-card img { cursor:pointer; border-radius:0.5rem; transition: transform 0.3s; }
    .product-card:hover img { transform: scale(1.05); }
    .admin-panel { display:none; }
    .image-preview-container img { max-width:80px; max-height:80px; border:1px solid #ccc; margin-right:5px; border-radius:0.25rem; }
    #image-modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; flex-direction:column; }
    #image-modal img { max-width:90vw; max-height:70vh; border-radius:0.5rem; box-shadow:0 0 20px rgba(255,255,255,0.3); margin-bottom:10px; cursor: grab; }
    #image-modal .close-btn { position:absolute; top:1rem; right:1rem; background:#fff; border:none; font-size:1.5rem; font-weight:bold; border-radius:0.5rem; width:2.5rem; height:2.5rem; cursor:pointer; line-height:1; text-align:center; padding:0; }
  </style>
</head>
<body>
  <header class="bg-white shadow-md sticky top-0 z-50 p-4 flex justify-between items-center">
    <div>
      <h1 class="text-2xl font-bold text-pink-600">Eunice Exclusiva</h1>
      <p class="text-sm text-gray-600">“Donde la moda cobra vida”</p>
    </div>
    <button id="admin-btn" class="bg-pink-600 text-white px-4 py-2 rounded hover:bg-pink-700">Admin</button>
  </header>

  <main class="container mx-auto px-4 py-8">
    <div id="products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main>

  <div id="image-modal" class="flex">
    <button class="close-btn" aria-label="Cerrar">&times;</button>
    <img src="" alt="Imagen ampliada" />
  </div>

  <section id="admin-panel" class="admin-panel container mx-auto px-4 py-8">
    <h3 class="text-2xl font-bold mb-4">Panel de Administración</h3>
    <form id="product-form" class="mb-8">
      <input type="text" id="product-name" placeholder="Nombre del Producto" required class="border p-2 rounded mb-2 w-full"/>
      <input type="text" id="product-category" placeholder="Categoría" required class="border p-2 rounded mb-2 w-full"/>
      <textarea id="product-description" placeholder="Descripción" required class="border p-2 rounded mb-2 w-full"></textarea>
      <input type="number" id="product-price" placeholder="Precio USD" min="0" step="0.01" required class="border p-2 rounded mb-2 w-full"/>
      <input type="file" id="product-image" accept="image/*" multiple required class="border p-2 rounded mb-2 w-full"/>
      <div id="image-preview-container" class="image-preview-container mb-2"></div>
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Agregar Producto</button>
    </form>
    <div id="admin-products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </section>

  <script type="module">
    import { ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

    let products = [];
    let isAdmin = false;
    const db = window.firebaseApp.db;

    function loadProductsFromFirebase(){
      const productsRef = ref(db, 'products');
      onValue(productsRef, snapshot=>{
        products = [];
        snapshot.forEach(child=> products.push({ id: child.key, ...child.val() }));
        renderProducts();
        renderAdminProducts();
      });
    }

    function renderProducts(){
      const container = document.getElementById('products');
      container.innerHTML = '';
      products.forEach(p=>{
        const card = document.createElement('div');
        card.className='product-card bg-white p-4 rounded shadow-md';
        card.innerHTML = `<img src="${p.image[0]}" alt="${p.name}" class="w-full h-auto max-h-72 object-contain rounded mb-4" />
          <h4 class="text-lg font-bold">${p.name}</h4>
          <p class="text-sm text-gray-600 mb-1">${p.category}</p>
          <p class="text-sm mb-1">${p.description}</p>
          <p class="text-pink-600 font-semibold text-lg">$${p.price.toFixed(2)}</p>`;
        container.appendChild(card);
      });
    }

    function renderAdminProducts(){
      if(!isAdmin) return;
      const container = document.getElementById('admin-products'); container.innerHTML='';
      products.forEach(p=>{
        const card=document.createElement('div'); card.className='product-card bg-white p-4 rounded shadow-md relative';
        card.innerHTML=`<img src="${p.image[0]}" class="w-full h-32 object-contain rounded mb-2"/>
          <h4 class="text-sm font-bold">${p.name}</h4>
          <p class="text-xs text-gray-600 mb-1">$${p.price.toFixed(2)}</p>
          <button onclick="editProduct('${p.id}')" class="bg-yellow-500 text-white px-2 py-1 rounded mt-2 mr-2">Editar</button>
          <button onclick="deleteProduct('${p.id}')" class="bg-red-500 text-white px-2 py-1 rounded mt-2">Eliminar</button>`;
        container.appendChild(card);
      });
    }

    window.deleteProduct = function(id){
      if(confirm('¿Eliminar este producto?')){
        remove(ref(db,'products/'+id)).then(()=> alert('Producto eliminado de Firebase.'));
      }
    }

    document.getElementById('admin-btn').addEventListener('click',()=>{
      const password=prompt('Ingresa contraseña admin:');
      if(password==='2005'){ isAdmin=true; document.getElementById('admin-panel').style.display='block'; renderAdminProducts(); alert('Acceso concedido'); }
      else alert('Contraseña incorrecta');
    });

    document.getElementById('product-image').addEventListener('change',e=>{
      const container=document.getElementById('image-preview-container'); container.innerHTML='';
      Array.from(e.target.files).slice(0,4).forEach(file=>{
        const reader = new FileReader();
        reader.onload = evt=>{
          const img=document.createElement('img'); img.src=evt.target.result; container.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });

    document.getElementById('product-form').addEventListener('submit',e=>{
      e.preventDefault();
      if(!isAdmin){ alert('Solo admin puede agregar productos'); return; }
      const name=document.getElementById('product-name').value;
      const category=document.getElementById('product-category').value;
      const description=document.getElementById('product-description').value;
      const price=parseFloat(document.getElementById('product-price').value);
      const files=document.getElementById('product-image').files;
      if(!files.length){ alert('Selecciona al menos una imagen'); return; }
      const images=[];
      let loaded=0;
      Array.from(files).slice(0,4).forEach(file=>{
        const reader = new FileReader();
        reader.onload = evt=>{
          images.push(evt.target.result); loaded++;
          if(loaded===Math.min(files.length,4)){
            const newProductRef = push(ref(db,'products'));
            set(newProductRef,{name,category,description,price,image:images})
              .then(()=>{ alert('Producto agregado a Firebase'); e.target.reset(); document.getElementById('image-preview-container').innerHTML=''; });
          }
        };
        reader.readAsDataURL(file);
      });
    });

    loadProductsFromFirebase();
  </script>
</body>
</html>
